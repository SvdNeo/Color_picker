

function startDrag(event) {
    const colorPicker = event.target;
    addActivePicker(colorPicker);
    const offsetX = event.clientX - parseInt(colorPicker.style.left);
    const offsetY = event.clientY - parseInt(colorPicker.style.top);
  
    function handleDragMove(moveEvent) {
      const x = moveEvent.clientX - offsetX;
      const y = moveEvent.clientY - offsetY;
      const colorPickerLeft =
        constrainValue(x, 0, imageCanvas.width - colorPicker.offsetWidth) + "px";
      const colorPickerTop =
        constrainValue(y, 0, imageCanvas.height - colorPicker.offsetHeight) +
        "px";
      const color = getColorAtPosition(colorPickerLeft, colorPickerTop);
      colorPicker.style.left = colorPickerLeft;
      colorPicker.style.top = colorPickerTop;
      colorPicker.style.backgroundColor = color;
      updateColorPalette();
    }
  
    function handleDragEnd() {
      document.removeEventListener("mousemove", handleDragMove);
      document.removeEventListener("mouseup", handleDragEnd);
    }
  
    document.addEventListener("mousemove", handleDragMove);
    document.addEventListener("mouseup", handleDragEnd);
  }
  
  function updateColorPalette() {
    colorPaletteContainer.innerHTML = "";
    hexValues = [];
    hexValues.forEach((color) => {
      const colorDiv = document.createElement("div");
      colorDiv.style.backgroundColor = color;
      colorPaletteContainer.appendChild(colorDiv);
    });
    colorPickers.forEach((colorPicker) => {
      const color = getColorAtPosition(
        colorPicker.style.left,
        colorPicker.style.top
      );
      const colorDiv = document.createElement("div");
      colorDiv.style.backgroundColor = color;
      colorPaletteContainer.appendChild(colorDiv);
      hexValues.push(color);
    });
    console.log(hexValues);
  }
  
  function getColorAtPosition(x, y) {
    const imageData = imageCanvas
      .getContext("2d")
      .getImageData(parseInt(x), parseInt(y), 1, 1).data;
    const hexColor = rgbToHex(imageData[0], imageData[1], imageData[2]);
    console.log(hexColor);
    return hexColor;
  }
  function exportPalette() {
    var modal = document.getElementById("myModal");
    var span = document.getElementsByClassName("close")[0];
    modal.style.display = "block";
    var csvFormat = generateCSV();
    document.getElementById("csvFormat").innerText = "CSV\n" + csvFormat;
    var withHashFormat = generateWithHash();
    document.getElementById("withHashFormat").innerText =
      "With #\n" + withHashFormat;
    var arrayFormat = generateArray();
    document.getElementById("arrayFormat").innerText = "Array\n" + arrayFormat;
    function generateCSV() {
      const capitalizedPalette = hexValues.map((color) =>
        color.toUpperCase().replace("#", "")
      );
      return capitalizedPalette.join(",");
    }
    function generateWithHash() {
      return hexValues.map((color) => color.toUpperCase()).join(", ");
    }
    function generateArray() {
      return (
        "[" +
        hexValues
          .map((color) => "'" + color.toUpperCase().replace("#", "") + "'")
          .join(", ") +
        "]"
      );
    }
    span.onclick = function () {
      modal.style.display = "none";
    };
    window.onclick = function (event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    };
  }
  function rgbToHex(r, g, b) {
    return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
  }
  
  function componentToHex(c) {
    const hex = c.toString(16);
    return hex.length == 1 ? "0" + hex : hex;
  }
  
  function getRandomPosition() {
    return Math.floor(Math.random() * 300);
  }
  
  function constrainValue(value, min, max) {
    return Math.min(Math.max(value, min), max);
  }
  
  function addActivePicker(colorPicker) {
    const pickers = document.querySelectorAll(".colorPicker");
    pickers.forEach((picker) => {
      picker.classList.remove("activePicker");
    });
    colorPicker.classList.add("activePicker");
    const color = getColorAtPosition(
      colorPicker.style.left,
      colorPicker.style.top
    );
    colorPicker.style.backgroundColor = color;
  }
  